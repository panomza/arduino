<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AceRoutine: /home/brian/dev/AceRoutine/src/ace_routine/Coroutine.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AceRoutine
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">A low-memory, fast-switching, cooperative multitasking library using stackless coroutines on Arduino platforms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_bbf1ec131ffa96b8d365d81f56025723.html">ace_routine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">Coroutine.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>All coroutines are instances of the Coroutine base class.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;Print.h&gt;</code><br />
<code>#include &quot;<a class="el" href="Flash_8h_source.html">Flash.h</a>&quot;</code><br />
<code>#include &quot;FCString.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Coroutine.h:</div>
<div class="dyncontent">
<div class="center"><img src="Coroutine_8h__incl.png" border="0" usemap="#_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8h" alt=""/></div>
<map name="_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8h" id="_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8h">
<area shape="rect" id="node4" href="Flash_8h.html" title="Various macros to smooth over the differences among the various platforms with regards to their suppo..." alt="" coords="110,95,175,121"/>
<area shape="rect" id="node5" href="FCString_8h_source.html" title="FCString.h" alt="" coords="200,95,285,121"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="Coroutine_8h__dep__incl.png" border="0" usemap="#_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8hdep" alt=""/></div>
<map name="_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8hdep" id="_2home_2brian_2dev_2AceRoutine_2src_2ace__routine_2Coroutine_8hdep">
<area shape="rect" id="node2" href="Channel_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/Channel.h" alt="" coords="105,95,291,136"/>
<area shape="rect" id="node3" href="AceRoutine_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/AceRoutine.h" alt="" coords="235,184,422,225"/>
<area shape="rect" id="node9" href="Coroutine_8cpp_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/Coroutine.cpp" alt="" coords="366,95,566,136"/>
<area shape="rect" id="node10" href="CoroutineScheduler_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/CoroutineScheduler.h" alt="" coords="591,95,835,136"/>
<area shape="rect" id="node4" href="CommandDispatcher_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/cli/CommandDispatcher.h" alt="" coords="43,370,313,411"/>
<area shape="rect" id="node6" href="CommandManager_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/cli/CommandManager.h" alt="" coords="313,467,571,508"/>
<area shape="rect" id="node7" href="CommandHandler_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/cli/CommandHandler.h" alt="" coords="121,273,373,315"/>
<area shape="rect" id="node8" href="StreamLineReader_8h_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/cli/StreamLine\lReader.h" alt="" coords="449,363,651,419"/>
<area shape="rect" id="node5" href="CommandDispatcher_8cpp_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/cli/CommandDispatcher.cpp" alt="" coords="5,467,289,508"/>
<area shape="rect" id="node11" href="CoroutineScheduler_8cpp_source.html" title="/home/brian/dev/AceRoutine\l/src/ace_routine/CoroutineScheduler.cpp" alt="" coords="583,184,842,225"/>
</map>
</div>
</div>
<p><a href="Coroutine_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__routine_1_1Coroutine.html">ace_routine::Coroutine</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class of all coroutines.  <a href="classace__routine_1_1Coroutine.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab22e58ab24b1908a7280f13603248ce3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#ab22e58ab24b1908a7280f13603248ce3">COROUTINE</a>(...)&#160;&#160;&#160;GET_COROUTINE(__VA_ARGS__, COROUTINE2, COROUTINE1)(__VA_ARGS__)</td></tr>
<tr class="memdesc:ab22e58ab24b1908a7280f13603248ce3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a Coroutine instance named 'name'.  <a href="#ab22e58ab24b1908a7280f13603248ce3">More...</a><br /></td></tr>
<tr class="separator:ab22e58ab24b1908a7280f13603248ce3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29e8a48695c9c365bdd589c061afba99"><td class="memItemLeft" align="right" valign="top"><a id="a29e8a48695c9c365bdd589c061afba99"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_COROUTINE</b>(_1,  _2,  NAME, ...)&#160;&#160;&#160;NAME</td></tr>
<tr class="separator:a29e8a48695c9c365bdd589c061afba99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d8219c8fc07650dfcdffbf83d800574"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>COROUTINE1</b>(name)</td></tr>
<tr class="separator:a8d8219c8fc07650dfcdffbf83d800574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04a0fdcb7293e51ddda298e237264c51"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>COROUTINE2</b>(className,  name)</td></tr>
<tr class="separator:a04a0fdcb7293e51ddda298e237264c51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79f1cf897012bbc4df5565f61adc3028"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a79f1cf897012bbc4df5565f61adc3028">EXTERN_COROUTINE</a>(...)</td></tr>
<tr class="memdesc:a79f1cf897012bbc4df5565f61adc3028"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create an extern reference to a coroutine that is defined in another .cpp file.  <a href="#a79f1cf897012bbc4df5565f61adc3028">More...</a><br /></td></tr>
<tr class="separator:a79f1cf897012bbc4df5565f61adc3028"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7a5384c8d2a434781a52a7e9b45c24d"><td class="memItemLeft" align="right" valign="top"><a id="ab7a5384c8d2a434781a52a7e9b45c24d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GET_EXTERN_COROUTINE</b>(_1,  _2,  NAME, ...)&#160;&#160;&#160;NAME</td></tr>
<tr class="separator:ab7a5384c8d2a434781a52a7e9b45c24d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab92199c3991124cbb6e5e48e27827dae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>EXTERN_COROUTINE1</b>(name)</td></tr>
<tr class="separator:ab92199c3991124cbb6e5e48e27827dae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af52549e71d4a6f7bd18c4688042776b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>EXTERN_COROUTINE2</b>(className,  name)</td></tr>
<tr class="separator:af52549e71d4a6f7bd18c4688042776b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7dc05639a37cb3f51bf348c68db283"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a7b7dc05639a37cb3f51bf348c68db283">COROUTINE_BEGIN</a>()</td></tr>
<tr class="memdesc:a7b7dc05639a37cb3f51bf348c68db283"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark the beginning of a coroutine.  <a href="#a7b7dc05639a37cb3f51bf348c68db283">More...</a><br /></td></tr>
<tr class="separator:a7b7dc05639a37cb3f51bf348c68db283"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adad73df0853c1d3040b88b3cd0a04c0e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#adad73df0853c1d3040b88b3cd0a04c0e">COROUTINE_LOOP</a>()</td></tr>
<tr class="memdesc:adad73df0853c1d3040b88b3cd0a04c0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark the beginning of a coroutine loop.  <a href="#adad73df0853c1d3040b88b3cd0a04c0e">More...</a><br /></td></tr>
<tr class="separator:adad73df0853c1d3040b88b3cd0a04c0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53efafb6fd212ea352f5ad52ea9bc393"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>COROUTINE_YIELD_INTERNAL</b>()</td></tr>
<tr class="separator:a53efafb6fd212ea352f5ad52ea9bc393"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a682abe1669f9fe28af63d11da5421cbf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a682abe1669f9fe28af63d11da5421cbf">COROUTINE_YIELD</a>()</td></tr>
<tr class="memdesc:a682abe1669f9fe28af63d11da5421cbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Yield execution to another coroutine.  <a href="#a682abe1669f9fe28af63d11da5421cbf">More...</a><br /></td></tr>
<tr class="separator:a682abe1669f9fe28af63d11da5421cbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f6714d9752740b6173b6afc4d108fa8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a9f6714d9752740b6173b6afc4d108fa8">COROUTINE_AWAIT</a>(condition)</td></tr>
<tr class="memdesc:a9f6714d9752740b6173b6afc4d108fa8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Yield until condition is true, then execution continues.  <a href="#a9f6714d9752740b6173b6afc4d108fa8">More...</a><br /></td></tr>
<tr class="separator:a9f6714d9752740b6173b6afc4d108fa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1391503960a4b0c48f8200f1ffa0e305"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a1391503960a4b0c48f8200f1ffa0e305">COROUTINE_DELAY</a>(delayMillis)</td></tr>
<tr class="memdesc:a1391503960a4b0c48f8200f1ffa0e305"><td class="mdescLeft">&#160;</td><td class="mdescRight">Yield for delayMillis.  <a href="#a1391503960a4b0c48f8200f1ffa0e305">More...</a><br /></td></tr>
<tr class="separator:a1391503960a4b0c48f8200f1ffa0e305"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeae79a8865a7fd6091a75f0c6515d2d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#aeae79a8865a7fd6091a75f0c6515d2d9">COROUTINE_DELAY_SECONDS</a>(loopCounter,  delaySeconds)</td></tr>
<tr class="memdesc:aeae79a8865a7fd6091a75f0c6515d2d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay for delaySeconds.  <a href="#aeae79a8865a7fd6091a75f0c6515d2d9">More...</a><br /></td></tr>
<tr class="separator:aeae79a8865a7fd6091a75f0c6515d2d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e326a8df652c46c42a8d713ddc67bd7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Coroutine_8h.html#a7e326a8df652c46c42a8d713ddc67bd7">COROUTINE_END</a>()</td></tr>
<tr class="memdesc:a7e326a8df652c46c42a8d713ddc67bd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark the end of a coroutine.  <a href="#a7e326a8df652c46c42a8d713ddc67bd7">More...</a><br /></td></tr>
<tr class="separator:a7e326a8df652c46c42a8d713ddc67bd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>All coroutines are instances of the Coroutine base class. </p>
<p>The <a class="el" href="Coroutine_8h.html#ab22e58ab24b1908a7280f13603248ce3" title="Create a Coroutine instance named &#39;name&#39;. ">COROUTINE()</a> macro creates these instances, and registers them to automatically run when CoroutineScheduler::loop() is called.</p>
<p>Various macros use macro overloading to implement a 1-argument and a 2-argument version. See <a href="https://stackoverflow.com/questions/11761703">https://stackoverflow.com/questions/11761703</a> to description of how that works.</p>
<p>The computed goto is a GCC extension: <a href="https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html">https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html</a> The <b>noinline</b> and <b>noclone</b> attributes make sure that label pointers are always the same. I'm not 100% sure they are needed here, but they don't seem to hurt. </p>

<p class="definition">Definition in file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab22e58ab24b1908a7280f13603248ce3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22e58ab24b1908a7280f13603248ce3">&#9670;&nbsp;</a></span>COROUTINE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td>&#160;&#160;&#160;GET_COROUTINE(__VA_ARGS__, COROUTINE2, COROUTINE1)(__VA_ARGS__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a Coroutine instance named 'name'. </p>
<p>Two forms are supported</p>
<ul>
<li><a class="el" href="Coroutine_8h.html#ab22e58ab24b1908a7280f13603248ce3" title="Create a Coroutine instance named &#39;name&#39;. ">COROUTINE(name)</a> {...}</li>
<li><a class="el" href="Coroutine_8h.html#ab22e58ab24b1908a7280f13603248ce3" title="Create a Coroutine instance named &#39;name&#39;. ">COROUTINE(className, name)</a> {...}</li>
</ul>
<p>The 1-argument form uses the Coroutine class as the base class of the coroutine. The 2-argument form uses the user-provided className which must be a subclass of Coroutine.</p>
<p>The code in {} following this macro becomes the body of the Coroutine::runCoroutine() method. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00064">64</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a8d8219c8fc07650dfcdffbf83d800574"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d8219c8fc07650dfcdffbf83d800574">&#9670;&nbsp;</a></span>COROUTINE1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE1</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">struct </span>Coroutine_##name : <a class="code" href="classace__routine_1_1Coroutine.html">ace_routine::Coroutine</a> { \</div><div class="line">  Coroutine_##name(); \</div><div class="line">  virtual <span class="keywordtype">int</span> <a class="code" href="classace__routine_1_1Coroutine.html#a08a2c559cf86917aac8b702354ab61e4">runCoroutine</a>() override \</div><div class="line">    __attribute__((__noinline__,__noclone__)); \</div><div class="line">} name; \</div><div class="line">Coroutine_<span class="preprocessor">##name :: Coroutine_##name() { \</span></div><div class="line"><span class="preprocessor">  setupCoroutine(ACE_ROUTINE_F(#name)); \</span></div><div class="line"><span class="preprocessor">} \</span></div><div class="line"><span class="preprocessor">int Coroutine_##name :: runCoroutine()</span></div><div class="ttc" id="classace__routine_1_1Coroutine_html_a08a2c559cf86917aac8b702354ab61e4"><div class="ttname"><a href="classace__routine_1_1Coroutine.html#a08a2c559cf86917aac8b702354ab61e4">ace_routine::Coroutine::runCoroutine</a></div><div class="ttdeci">virtual int runCoroutine()=0</div><div class="ttdoc">The body of the coroutine. </div></div>
<div class="ttc" id="classace__routine_1_1Coroutine_html"><div class="ttname"><a href="classace__routine_1_1Coroutine.html">ace_routine::Coroutine</a></div><div class="ttdoc">Base class of all coroutines. </div><div class="ttdef"><b>Definition:</b> <a href="Coroutine_8h_source.html#l00271">Coroutine.h:271</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00069">69</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a04a0fdcb7293e51ddda298e237264c51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04a0fdcb7293e51ddda298e237264c51">&#9670;&nbsp;</a></span>COROUTINE2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">className, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">struct </span>className##_##name : className { \</div><div class="line">  className##_##name(); \</div><div class="line">  virtual <span class="keywordtype">int</span> runCoroutine() override \</div><div class="line">    __attribute__((__noinline__,__noclone__)); \</div><div class="line">} name; \</div><div class="line">className<span class="preprocessor">##_##name :: className##_##name() { \</span></div><div class="line"><span class="preprocessor">  setupCoroutine(ACE_ROUTINE_F(#name)); \</span></div><div class="line"><span class="preprocessor">} \</span></div><div class="line"><span class="preprocessor">int className##_##name :: runCoroutine()</span></div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00080">80</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a9f6714d9752740b6173b6afc4d108fa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f6714d9752740b6173b6afc4d108fa8">&#9670;&nbsp;</a></span>COROUTINE_AWAIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_AWAIT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">condition</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      while (!(condition)) { \</div><div class="line">        setYielding(); \</div><div class="line">        COROUTINE_YIELD_INTERNAL(); \</div><div class="line">      } \</div><div class="line">      setRunning(); \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p>Yield until condition is true, then execution continues. </p>
<p>This is functionally equivalent to:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (!condition) <a class="code" href="Coroutine_8h.html#a682abe1669f9fe28af63d11da5421cbf">COROUTINE_YIELD</a>();</div></div><!-- fragment --><p>but potentially slightly more efficient. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00162">162</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a7b7dc05639a37cb3f51bf348c68db283"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7dc05639a37cb3f51bf348c68db283">&#9670;&nbsp;</a></span>COROUTINE_BEGIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_BEGIN</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordtype">void</span>* p = getJump(); \</div><div class="line">    if (p != <span class="keyword">nullptr</span>) { \</div><div class="line">      goto *p; \</div><div class="line">    }</div></div><!-- fragment -->
<p>Mark the beginning of a coroutine. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00122">122</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a1391503960a4b0c48f8200f1ffa0e305"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1391503960a4b0c48f8200f1ffa0e305">&#9670;&nbsp;</a></span>COROUTINE_DELAY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_DELAY</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">delayMillis</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      setDelay(delayMillis); \</div><div class="line">      while (!isDelayExpired()) { \</div><div class="line">        setDelaying(); \</div><div class="line">        COROUTINE_YIELD_INTERNAL(); \</div><div class="line">      } \</div><div class="line">      setRunning(); \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p>Yield for delayMillis. </p>
<p>A delayMillis of 0 is functionally equivalent to <a class="el" href="Coroutine_8h.html#a682abe1669f9fe28af63d11da5421cbf" title="Yield execution to another coroutine. ">COROUTINE_YIELD()</a>. To save memory, the delayMillis is stored as a uint16_t but the actual maximum is limited to 32767 millliseconds. See setDelay() for the reason for this limitation.</p>
<p>If you need to wait for longer than that, use a for-loop to call <a class="el" href="Coroutine_8h.html#a1391503960a4b0c48f8200f1ffa0e305" title="Yield for delayMillis. ">COROUTINE_DELAY()</a> as many times as necessary.</p>
<p>This could have been implemented using <a class="el" href="Coroutine_8h.html#a9f6714d9752740b6173b6afc4d108fa8" title="Yield until condition is true, then execution continues. ">COROUTINE_AWAIT()</a> but this macro matches the global delay(millis) function already provided by the Arduino API. Also having a separate kStatusDelaying state allows the CoroutineScheduler to be slightly more efficient by avoiding the call to Coroutine::runCoroutine() if the delay has not expired. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00186">186</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="aeae79a8865a7fd6091a75f0c6515d2d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeae79a8865a7fd6091a75f0c6515d2d9">&#9670;&nbsp;</a></span>COROUTINE_DELAY_SECONDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_DELAY_SECONDS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">loopCounter, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">delaySeconds&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      loopCounter = delaySeconds; \</div><div class="line">      while (loopCounter-- &gt; 0) { \</div><div class="line">        COROUTINE_DELAY(1000); \</div><div class="line">      } \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p>Delay for delaySeconds. </p>
<p>Maximum value is the maximum value of the loopCounter which can be any integer type. For example, if the loopCounter is a uint16_t, then the maximum delay is 65535 seconds, or 18h12m15s. This macro calls <a class="el" href="Coroutine_8h.html#a1391503960a4b0c48f8200f1ffa0e305" title="Yield for delayMillis. ">COROUTINE_DELAY()</a> every 1000 milliseconds, so over the course of the entire delay, there may be some drift. (Some of this drift could be avoided by looping in 16000ms chunks, then looping the remainder in 1000ms chunks. Division of delaySeconds by 16 would be fast. But minimizing drift doesn't seem to be important for the use cases that I have in mind, so I haven't implemented this.)</p>
<p>The loopCounter needs to be supplied to the macro because AceRoutine coroutines are stackless so the loop cannot use the stack to keep count of the number of seconds. Instead it needs to be given a loop counter that retains information across multiple calls. That loop counter can be a member variable of the Coroutine object, or it can be a function-static variable.</p>
<p>The usage would be something like: </p><div class="fragment"><div class="line"><span class="keyword">class </span>MyCoroutine: <span class="keyword">public</span> Coroutine {</div><div class="line">  <span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> runCoroutine()<span class="keyword"> override </span>{</div><div class="line">      ...</div><div class="line">      <a class="code" href="Coroutine_8h.html#aeae79a8865a7fd6091a75f0c6515d2d9">COROUTINE_DELAY_SECONDS</a>(mDelayCounter, 1000);</div><div class="line">      ...</div><div class="line">    }</div><div class="line"></div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    uint16_t mDelayCounter;</div><div class="line">};</div><div class="line">...</div></div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line"><a class="code" href="Coroutine_8h.html#ab22e58ab24b1908a7280f13603248ce3">COROUTINE</a>(myRoutine) {</div><div class="line">  <a class="code" href="Coroutine_8h.html#adad73df0853c1d3040b88b3cd0a04c0e">COROUTINE_LOOP</a>() {</div><div class="line">    ...</div><div class="line">    <span class="keyword">static</span> uint16_t delayCounter;</div><div class="line">    <a class="code" href="Coroutine_8h.html#aeae79a8865a7fd6091a75f0c6515d2d9">COROUTINE_DELAY_SECONDS</a>(delayCounter, 1000);</div><div class="line">    ...</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00242">242</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a7e326a8df652c46c42a8d713ddc67bd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e326a8df652c46c42a8d713ddc67bd7">&#9670;&nbsp;</a></span>COROUTINE_END</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_END</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      __label__ jumpLabel; \</div><div class="line">      setEnding(); \</div><div class="line">      setJump(&amp;&amp; jumpLabel); \</div><div class="line">      jumpLabel: ; \</div><div class="line">      return 0; \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p>Mark the end of a coroutine. </p>
<p>Subsequent calls to Coroutine::runCoroutine() will do nothing. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00254">254</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="adad73df0853c1d3040b88b3cd0a04c0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adad73df0853c1d3040b88b3cd0a04c0e">&#9670;&nbsp;</a></span>COROUTINE_LOOP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_LOOP</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><a class="code" href="Coroutine_8h.html#a7b7dc05639a37cb3f51bf348c68db283">COROUTINE_BEGIN</a>(); \</div><div class="line">   while (<span class="keyword">true</span>) \</div><div class="ttc" id="Coroutine_8h_html_a7b7dc05639a37cb3f51bf348c68db283"><div class="ttname"><a href="Coroutine_8h.html#a7b7dc05639a37cb3f51bf348c68db283">COROUTINE_BEGIN</a></div><div class="ttdeci">#define COROUTINE_BEGIN()</div><div class="ttdoc">Mark the beginning of a coroutine. </div><div class="ttdef"><b>Definition:</b> <a href="Coroutine_8h_source.html#l00122">Coroutine.h:122</a></div></div>
</div><!-- fragment -->
<p>Mark the beginning of a coroutine loop. </p>
<p>Can be used instead of <a class="el" href="Coroutine_8h.html#a7b7dc05639a37cb3f51bf348c68db283" title="Mark the beginning of a coroutine. ">COROUTINE_BEGIN()</a> at the beginning of a Coroutine. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00132">132</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a682abe1669f9fe28af63d11da5421cbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a682abe1669f9fe28af63d11da5421cbf">&#9670;&nbsp;</a></span>COROUTINE_YIELD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_YIELD</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      setYielding(); \</div><div class="line">      COROUTINE_YIELD_INTERNAL(); \</div><div class="line">      setRunning(); \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p>Yield execution to another coroutine. </p>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00145">145</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a53efafb6fd212ea352f5ad52ea9bc393"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53efafb6fd212ea352f5ad52ea9bc393">&#9670;&nbsp;</a></span>COROUTINE_YIELD_INTERNAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COROUTINE_YIELD_INTERNAL</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">      __label__ jumpLabel; \</div><div class="line">      setJump(&amp;&amp; jumpLabel); \</div><div class="line">      return 0; \</div><div class="line">      jumpLabel: ; \</div><div class="line">    } <span class="keywordflow">while</span> (<span class="keyword">false</span>)</div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00136">136</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="a79f1cf897012bbc4df5565f61adc3028"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79f1cf897012bbc4df5565f61adc3028">&#9670;&nbsp;</a></span>EXTERN_COROUTINE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXTERN_COROUTINE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">GET_EXTERN_COROUTINE(\</div><div class="line">        __VA_ARGS__, EXTERN_COROUTINE2, EXTERN_COROUTINE1)(__VA_ARGS__)</div></div><!-- fragment -->
<p>Create an extern reference to a coroutine that is defined in another .cpp file. </p>
<p>The extern reference is needed before it can be used. Two forms are supported:</p>
<ul>
<li><a class="el" href="Coroutine_8h.html#a79f1cf897012bbc4df5565f61adc3028" title="Create an extern reference to a coroutine that is defined in another .cpp file. ">EXTERN_COROUTINE(name)</a>;</li>
<li><a class="el" href="Coroutine_8h.html#a79f1cf897012bbc4df5565f61adc3028" title="Create an extern reference to a coroutine that is defined in another .cpp file. ">EXTERN_COROUTINE(className, name)</a>; </li>
</ul>

<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00099">99</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="ab92199c3991124cbb6e5e48e27827dae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab92199c3991124cbb6e5e48e27827dae">&#9670;&nbsp;</a></span>EXTERN_COROUTINE1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXTERN_COROUTINE1</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">struct </span>Coroutine_##name : <a class="code" href="classace__routine_1_1Coroutine.html">ace_routine::Coroutine</a> { \</div><div class="line">  Coroutine_##name(); \</div><div class="line">  virtual <span class="keywordtype">int</span> <a class="code" href="classace__routine_1_1Coroutine.html#a08a2c559cf86917aac8b702354ab61e4">runCoroutine</a>() override \</div><div class="line">    __attribute__((__noinline__,__noclone__)); \</div><div class="line">}; \</div><div class="line">extern Coroutine_<span class="preprocessor">##name name</span></div><div class="ttc" id="classace__routine_1_1Coroutine_html_a08a2c559cf86917aac8b702354ab61e4"><div class="ttname"><a href="classace__routine_1_1Coroutine.html#a08a2c559cf86917aac8b702354ab61e4">ace_routine::Coroutine::runCoroutine</a></div><div class="ttdeci">virtual int runCoroutine()=0</div><div class="ttdoc">The body of the coroutine. </div></div>
<div class="ttc" id="classace__routine_1_1Coroutine_html"><div class="ttname"><a href="classace__routine_1_1Coroutine.html">ace_routine::Coroutine</a></div><div class="ttdoc">Base class of all coroutines. </div><div class="ttdef"><b>Definition:</b> <a href="Coroutine_8h_source.html#l00271">Coroutine.h:271</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00105">105</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
<a id="af52549e71d4a6f7bd18c4688042776b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af52549e71d4a6f7bd18c4688042776b6">&#9670;&nbsp;</a></span>EXTERN_COROUTINE2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXTERN_COROUTINE2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">className, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">struct </span>className##_##name : className { \</div><div class="line">  className##_##name(); \</div><div class="line">  virtual <span class="keywordtype">int</span> runCoroutine() override \</div><div class="line">    __attribute__((__noinline__,__noclone__)); \</div><div class="line">}; \</div><div class="line">extern className<span class="preprocessor">##_##name name</span></div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="Coroutine_8h_source.html#l00113">113</a> of file <a class="el" href="Coroutine_8h_source.html">Coroutine.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
